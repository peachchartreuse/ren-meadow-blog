---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title}>
  <article class="blog-post">
    <header class="post-header">
      <h1>{post.data.title}</h1>
      <div class="post-meta">
        <span class="date">{post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' })}</span>
      </div>
    </header>

    {post.data.image && (
      <img src={post.data.image} alt={post.data.title} class="featured-image" />
    )}

    <div class="post-content">
      <Content />
    </div>

    <div class="post-navigation">
      <a href="#" class="nav-link">previous post</a>
      <a href="#" class="nav-link">next post</a>
    </div>

    <div class="post-tags">
      <span>tags: </span>
      {post.data.tags.map((tag, index) => (
        <>
          <a href={`/blog/${tag}`}>{tag}</a>
          {index < post.data.tags.length - 1 && <span>, </span>}
        </>
      ))}
    </div>
  </article>

  <aside class="sidebar">
    <h3>Journal</h3>
    <ul>
      <li><a href="/blog">All topics</a></li>
      <li><a href="/blog/arts-crafts">Arts & crafts</a></li>
      <li><a href="/blog/law-school">Law school</a></li>
      <li><a href="/blog/media-reviews">Media reviews</a></li>
      <li><a href="/blog/musings">Musings</a></li>
      <li><a href="/blog/recipes">Recipes</a></li>
    </ul>
  </aside>
</Layout>

<style>
  :global(main) {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 4rem;
  }

  .blog-post {
    max-width: 800px;
  }

  .post-header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .post-meta {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    font-size: 1rem;
  }

  .date {
    color: var(--warm-brown);
  }

  .featured-image {
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 4px;
  }

  .post-content {
    margin-bottom: 3rem;
    line-height: 1.8;
  }

  .post-content :global(p) {
    margin-bottom: 1.5rem;
  }

  .post-navigation {
    display: flex;
    justify-content: space-between;
    padding: 2rem 0;
    border-top: 1px solid rgba(0,0,0,0.1);
    border-bottom: 1px solid rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
  }

  .nav-link {
    color: var(--brown);
    text-decoration: underline;
  }

  .post-tags {
    color: var(--brown);
  }

  .post-tags a {
    text-decoration: underline;
    margin-left: 0.5rem;
  }

  .sidebar {
    padding-top: 4rem;
  }

  .sidebar h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }

  .sidebar ul {
    list-style: none;
  }

  .sidebar li {
    margin-bottom: 0.75rem;
  }

  .sidebar a {
    color: var(--brown);
    text-decoration: underline;
  }

  @media (max-width: 968px) {
    :global(main) {
      grid-template-columns: 1fr;
    }
  }
</style>